{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\panug\\\\Desktop\\\\All_React_Projects\\\\react-tailwind\\\\moviebook\\\\frontend\\\\src\\\\context\\\\SocketContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useRef, useState } from 'react';\nimport { io } from 'socket.io-client';\nimport { useAuth } from './AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SocketContext = /*#__PURE__*/createContext();\nexport const useSocket = () => {\n  _s();\n  const context = useContext(SocketContext);\n  if (!context) {\n    throw new Error('useSocket must be used within a SocketProvider');\n  }\n  return context;\n};\n_s(useSocket, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const SocketProvider = ({\n  children\n}) => {\n  _s2();\n  const [socket, setSocket] = useState(null);\n  const [connected, setConnected] = useState(false);\n  const [seatLocks, setSeatLocks] = useState({});\n  const [activeShow, setActiveShow] = useState(null);\n  const {\n    user\n  } = useAuth();\n  const socketRef = useRef(null);\n  useEffect(() => {\n    if (user) {\n      initializeSocket();\n    } else {\n      disconnectSocket();\n    }\n    return () => {\n      disconnectSocket();\n    };\n  }, [user]);\n  const initializeSocket = () => {\n    var _socketRef$current;\n    if ((_socketRef$current = socketRef.current) !== null && _socketRef$current !== void 0 && _socketRef$current.connected) {\n      return;\n    }\n    const newSocket = io(process.env.REACT_APP_SOCKET_URL || 'http://localhost:5000', {\n      auth: {\n        token: localStorage.getItem('accessToken')\n      }\n    });\n    socketRef.current = newSocket;\n    newSocket.on('connect', () => {\n      console.log('Socket connected:', newSocket.id);\n      setConnected(true);\n      setSocket(newSocket);\n    });\n    newSocket.on('disconnect', () => {\n      console.log('Socket disconnected');\n      setConnected(false);\n    });\n    newSocket.on('connect_error', error => {\n      console.error('Socket connection error:', error);\n      setConnected(false);\n    });\n\n    // Seat lock events\n    newSocket.on('seatLocksUpdated', data => {\n      console.log('Seat locks updated:', data);\n      setSeatLocks(prev => ({\n        ...prev,\n        [data.showId]: data.lockedSeats\n      }));\n    });\n    newSocket.on('seatBooked', data => {\n      console.log('Seat booked:', data);\n      // Update seat locks to remove booked seats\n      setSeatLocks(prev => ({\n        ...prev,\n        [data.showId]: (prev[data.showId] || []).filter(seatId => !data.bookedSeats.includes(seatId))\n      }));\n    });\n    newSocket.on('bookingConfirmed', data => {\n      console.log('Booking confirmed:', data);\n      // Handle booking confirmation updates\n    });\n    newSocket.on('error', error => {\n      console.error('Socket error:', error);\n    });\n    setSocket(newSocket);\n  };\n  const disconnectSocket = () => {\n    if (socketRef.current) {\n      socketRef.current.disconnect();\n      socketRef.current = null;\n      setSocket(null);\n      setConnected(false);\n      setSeatLocks({});\n    }\n  };\n  const joinShow = showId => {\n    if (socket && connected) {\n      socket.emit('joinShow', showId);\n      setActiveShow(showId);\n    }\n  };\n  const leaveShow = showId => {\n    if (socket && connected) {\n      socket.emit('leaveShow', showId);\n      if (activeShow === showId) {\n        setActiveShow(null);\n      }\n    }\n  };\n  const requestSeatLock = (showId, seatIds) => {\n    if (socket && connected) {\n      socket.emit('requestLock', {\n        showId,\n        seatIds,\n        userId: user === null || user === void 0 ? void 0 : user.id\n      });\n    }\n  };\n  const releaseSeatLock = (showId, seatIds) => {\n    if (socket && connected) {\n      socket.emit('releaseLock', {\n        showId,\n        seatIds,\n        userId: user === null || user === void 0 ? void 0 : user.id\n      });\n    }\n  };\n  const getLockedSeats = showId => {\n    return seatLocks[showId] || [];\n  };\n  const isSeatLocked = (showId, seatId) => {\n    const lockedSeats = getLockedSeats(showId);\n    return lockedSeats.includes(seatId);\n  };\n  const value = {\n    socket,\n    connected,\n    seatLocks,\n    activeShow,\n    joinShow,\n    leaveShow,\n    requestSeatLock,\n    releaseSeatLock,\n    getLockedSeats,\n    isSeatLocked\n  };\n  return /*#__PURE__*/_jsxDEV(SocketContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 163,\n    columnNumber: 5\n  }, this);\n};\n_s2(SocketProvider, \"7MTU2bhXbPKj9o57jOUYmG7k2yQ=\", false, function () {\n  return [useAuth];\n});\n_c = SocketProvider;\nvar _c;\n$RefreshReg$(_c, \"SocketProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useRef","useState","io","useAuth","jsxDEV","_jsxDEV","SocketContext","useSocket","_s","context","Error","SocketProvider","children","_s2","socket","setSocket","connected","setConnected","seatLocks","setSeatLocks","activeShow","setActiveShow","user","socketRef","initializeSocket","disconnectSocket","_socketRef$current","current","newSocket","process","env","REACT_APP_SOCKET_URL","auth","token","localStorage","getItem","on","console","log","id","error","data","prev","showId","lockedSeats","filter","seatId","bookedSeats","includes","disconnect","joinShow","emit","leaveShow","requestSeatLock","seatIds","userId","releaseSeatLock","getLockedSeats","isSeatLocked","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/panug/Desktop/All_React_Projects/react-tailwind/moviebook/frontend/src/context/SocketContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useRef, useState } from 'react';\r\nimport { io } from 'socket.io-client';\r\nimport { useAuth } from './AuthContext';\r\n\r\nconst SocketContext = createContext();\r\n\r\nexport const useSocket = () => {\r\n  const context = useContext(SocketContext);\r\n  if (!context) {\r\n    throw new Error('useSocket must be used within a SocketProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const SocketProvider = ({ children }) => {\r\n  const [socket, setSocket] = useState(null);\r\n  const [connected, setConnected] = useState(false);\r\n  const [seatLocks, setSeatLocks] = useState({});\r\n  const [activeShow, setActiveShow] = useState(null);\r\n  const { user } = useAuth();\r\n  const socketRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      initializeSocket();\r\n    } else {\r\n      disconnectSocket();\r\n    }\r\n\r\n    return () => {\r\n      disconnectSocket();\r\n    };\r\n  }, [user]);\r\n\r\n  const initializeSocket = () => {\r\n    if (socketRef.current?.connected) {\r\n      return;\r\n    }\r\n\r\n    const newSocket = io(process.env.REACT_APP_SOCKET_URL || 'http://localhost:5000', {\r\n      auth: {\r\n        token: localStorage.getItem('accessToken'),\r\n      },\r\n    });\r\n\r\n    socketRef.current = newSocket;\r\n\r\n    newSocket.on('connect', () => {\r\n      console.log('Socket connected:', newSocket.id);\r\n      setConnected(true);\r\n      setSocket(newSocket);\r\n    });\r\n\r\n    newSocket.on('disconnect', () => {\r\n      console.log('Socket disconnected');\r\n      setConnected(false);\r\n    });\r\n\r\n    newSocket.on('connect_error', (error) => {\r\n      console.error('Socket connection error:', error);\r\n      setConnected(false);\r\n    });\r\n\r\n    // Seat lock events\r\n    newSocket.on('seatLocksUpdated', (data) => {\r\n      console.log('Seat locks updated:', data);\r\n      setSeatLocks(prev => ({\r\n        ...prev,\r\n        [data.showId]: data.lockedSeats\r\n      }));\r\n    });\r\n\r\n    newSocket.on('seatBooked', (data) => {\r\n      console.log('Seat booked:', data);\r\n      // Update seat locks to remove booked seats\r\n      setSeatLocks(prev => ({\r\n        ...prev,\r\n        [data.showId]: (prev[data.showId] || []).filter(seatId => !data.bookedSeats.includes(seatId))\r\n      }));\r\n    });\r\n\r\n    newSocket.on('bookingConfirmed', (data) => {\r\n      console.log('Booking confirmed:', data);\r\n      // Handle booking confirmation updates\r\n    });\r\n\r\n    newSocket.on('error', (error) => {\r\n      console.error('Socket error:', error);\r\n    });\r\n\r\n    setSocket(newSocket);\r\n  };\r\n\r\n  const disconnectSocket = () => {\r\n    if (socketRef.current) {\r\n      socketRef.current.disconnect();\r\n      socketRef.current = null;\r\n      setSocket(null);\r\n      setConnected(false);\r\n      setSeatLocks({});\r\n    }\r\n  };\r\n\r\n  const joinShow = (showId) => {\r\n    if (socket && connected) {\r\n      socket.emit('joinShow', showId);\r\n      setActiveShow(showId);\r\n    }\r\n  };\r\n\r\n  const leaveShow = (showId) => {\r\n    if (socket && connected) {\r\n      socket.emit('leaveShow', showId);\r\n      if (activeShow === showId) {\r\n        setActiveShow(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  const requestSeatLock = (showId, seatIds) => {\r\n    if (socket && connected) {\r\n      socket.emit('requestLock', {\r\n        showId,\r\n        seatIds,\r\n        userId: user?.id\r\n      });\r\n    }\r\n  };\r\n\r\n  const releaseSeatLock = (showId, seatIds) => {\r\n    if (socket && connected) {\r\n      socket.emit('releaseLock', {\r\n        showId,\r\n        seatIds,\r\n        userId: user?.id\r\n      });\r\n    }\r\n  };\r\n\r\n  const getLockedSeats = (showId) => {\r\n    return seatLocks[showId] || [];\r\n  };\r\n\r\n  const isSeatLocked = (showId, seatId) => {\r\n    const lockedSeats = getLockedSeats(showId);\r\n    return lockedSeats.includes(seatId);\r\n  };\r\n\r\n  const value = {\r\n    socket,\r\n    connected,\r\n    seatLocks,\r\n    activeShow,\r\n    joinShow,\r\n    leaveShow,\r\n    requestSeatLock,\r\n    releaseSeatLock,\r\n    getLockedSeats,\r\n    isSeatLocked,\r\n  };\r\n\r\n  return (\r\n    <SocketContext.Provider value={value}>\r\n      {children}\r\n    </SocketContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}